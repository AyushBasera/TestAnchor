{% extends "quizApp/layout.html" %}
{% block body %}
<div><h3>Title: {{ test.title }}</h3></div>
<div><h5>UserName: {{ request.user.name }}</h5></div>
<div><strong>Time Left: </strong><span id="timeLeft"></span></div>
<form method='POST' action="{% url 'submitAQuiz' test.id %}">
    {% csrf_token %}
    {% for question in questions %}
        <div class="mb-4">
            <p>{{ question.question_text }}</p>
            <div>
                <label><input type="radio" name="q{{ question.id }}" value="A"> {{ question.option_a }}</label><br>
                <label><input type="radio" name="q{{ question.id }}" value="B"> {{ question.option_b }}</label><br>
                <label><input type="radio" name="q{{ question.id }}" value="C"> {{ question.option_c }}</label><br>
                <label><input type="radio" name="q{{ question.id }}" value="D"> {{ question.option_d }}</label>
            </div>
        </div>
    {% endfor %}
    <button type="submit" class="btn btn-success">Submit Quiz</button>
</form>
{% endblock %}
{% block script %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let display = document.querySelector('#timeLeft');
        let duration = parseInt("{{ remaining_seconds|default:0 }}");

        function formatTime(time) {
            return `${Math.floor(time / 60)}:${(time % 60).toString().padStart(2, '0')}`;
        }

        function countDown() {
            if (duration <= 0) {
                alert("Time's up! Auto-submitting your quiz...");
                document.querySelector('form').submit();
            } else {
                display.innerText = formatTime(duration);
                duration--;
                setTimeout(countDown, 1000);
            }
        }

        countDown();
    });
</script>

{% endblock %}
