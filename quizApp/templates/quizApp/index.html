{% extends 'quizApp/layout.html' %}
{% load static %}
{% block body %}
<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<!-- jQuery (required by Select2) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <h2>Quiz App</h2>
    {% if request.user.user_type == "Student" %}
    <button class="btn btn-sm btn-outline-primary" id="JoinQuiz">JoinQuiz</button>
    <button class="btn btn-sm btn-outline-primary" id="ViewScore">ViewScore</button>
    <a href="{% url 'my_tests' %}" class="btn btn-sm btn-outline-primary">my_tests</a>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'logout' %}">Log Out</a>
    <hr>
    
    <div id="whenViewScore">
        <!-- to view score -->
        <div><h2>View Score of all your previous tests</h2></div>
        <a href="{% url 'index' %}" class="btn btn-primary mb-2">Go_Back</a>
        <div id="whenViewScore1"></div>
    </div> 
    <div id="whenJoinQuiz">
        <!-- to join a quiz -->
        <div><h2>Join A Quiz By Providing Its RoomID</h2></div>
        <a href="{% url 'index' %}" class="btn btn-primary mb-2">Go_Back</a>
        {% if join_error %}
            <div id="joinAlert" class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ join_error }}
            </div>
            <script>
                document.addEventListener('DOMContentLoaded',function(){
                    document.querySelector("#whenJoinQuiz").style.display='block';
                })
                setTimeout(() => {
                    const alertBox = document.getElementById('joinAlert');
                    if (alertBox) {
                        alertBox.style.display = 'none';
                    }
                }, 4000);  // Hides alert after 4 seconds
            </script>
        {% endif %}
        <form action="{% url 'joinAQuiz' %}" method="POST">
            {% csrf_token %}
            <div id="form-group">
                <input type="text" class="form-control" name="roomID" placeholder="roomID">
            </div>
            <input type="submit" class="btn btn-primary" value="Join">
        </form>
    </div>
    {% endif %}

    {% if request.user.user_type == "Teacher" %}
    <button class="btn btn-sm btn-outline-primary" id="CreateQuiz">CreateQuiz</button>
    <button class="btn btn-sm btn-outline-primary" id="StudentScore">All Tests</button>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'logout' %}">Log Out</a>
    <hr>
    <div id="whenCreateQuiz">
        <!-- to create quiz -->
        <h3>Create a New Quiz</h3>
        <a href="{% url 'index' %}" class="btn btn-primary mb-2 ">Go_Back</a>
        <form id="createQuizForm">
            {% csrf_token %}
            <input type="text" name="title" class="form-control mb-2" placeholder="Quiz Title" required>
            <input type="datetime-local" name="start_time" class="form-control mb-2" required>
            <input type="number" name="duration_minutes" class="form-control mb-2" placeholder="Duration in minutes" required>
            <select name="allowed_students" id="allowed_students" class="form-control mb-2" multiple>
                {% for student in students %}
                    <option value="{{ student.id }}">{{ student.get_full_name }} ({{ student.email }})</option>
                {% endfor %}
            </select>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    // Convert Django-rendered dropdown into Select2 enhanced multi-select
                    $('#allowed_students').select2({
                        placeholder: "Select allowed students",
                        width: '100%'  // match Bootstrap width
                    });
                });
            </script>

            <button type="submit" class="btn btn-primary">Create Quiz</button>
        </form>

        <div id="whenCreateQuestions"></div>
    </div> 
    <div id="whenStudentScore">
        <h3>View Score of the students</h3>
        <a href="{% url 'index' %}" class="btn btn-primary mb-2">Go_Back</a>
        <!-- to view Student Score -->
        <div id="whenStudentScore1"></div>
    </div>
    <div id="studentList" style="display: none;">
        <h3>Student List (Ranked)</h3>
        <a href="{% url 'index' %}" class="btn btn-primary mb-2">Go_Back</a>
        <div id="studentListContent"></div>
    </div>

    {% endif %}

{% endblock %}


{% block script %}
<script src="{% static 'quizApp/index.js' %}"></script>
{% endblock %}