{% extends 'quizApp/layout.html' %}
{% block body %}
<h2>Add Questions to Quiz: {{ test.title }}</h2>

<form id="questionForm">
    {% csrf_token %}
    <input type="hidden" id="test_id" value="{{ test.id }}">
    <div class="mb-2">
        <textarea class='form-control' name="question_text" placeholder="Enter question text" required></textarea>
    </div>
    <div class="mb-2"><input class="form-control" name="option_a" placeholder="Option A"></div>
    <div class="mb-2"><input class="form-control" name="option_b" placeholder="Option B"></div>
    <div class="mb-2"><input class="form-control" name="option_c" placeholder="Option C"></div>
    <div class="mb-2"><input class="form-control" name="option_d" placeholder="Option D"></div>
    <div class="mb-2">
        <select class="form-control" name="correct_option" required>
            <option value="">Select Correct Option</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Add Question</button>
</form>
<hr>
<div id="questionList"><h4>Questions Added:</h4></div>

{% endblock %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    console.log("Script is running");
    const form = document.querySelector('#questionForm');
    if (form) {
        console.log("Form found!");

        form.addEventListener('submit', function(event) {
            alert("JS submit triggered");
            event.preventDefault();  

            console.log("Form submitted via JS");

            const testID = document.querySelector('#test_id').value;
            const formData = new FormData(form); 

            fetch(`/add-question/${testID}`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.success) {
                    alert("Question added!");
                    form.reset();  

                    const qList = document.querySelector('#questionList');
                    const div = document.createElement('div');
                    div.innerText = data.question;
                    qList.appendChild(div);
                } else {
                    alert(data.error || "Unknown error");
                }
            })
            .catch(error => {
                console.error("Error submitting form:", error);
            });
        });
    } else {
        console.log("Form NOT found!");
    }
});
</script>

{% endblock %}